{% extends "progress/base_progress.html" %}

{% block container_class %}wide-screen{% endblock %}

{% block progress_content %}
<div class="space-y-6">
    <!-- 헤더 영역 -->
    <div class="flex justify-between items-center">
        <h2 class="text-2xl font-bold text-gray-800">교재-문제 연결 목록</h2>
        <a href="{% url 'progress:book_problem_create' %}"
           class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
            + 연결 추가
        </a>
    </div>

    <!-- 교재 필터 -->
    <div class="bg-white rounded-lg shadow p-4">
        <form method="GET" class="flex gap-4 items-center">
            <label class="font-medium text-gray-700">교재 선택:</label>
            <select name="book" onchange="this.form.submit()" class="form-input max-w-md">
                <option value="">-- 전체 교재 --</option>
                {% for book in books %}
                    <option value="{{ book.pk }}" {% if selected_book == book.pk|stringformat:"s" %}selected{% endif %}>
                        {{ book.title }}
                    </option>
                {% endfor %}
            </select>
        </form>
    </div>

    <!-- 문제 목록 테이블 -->
    <div class="bg-white rounded-lg shadow overflow-hidden">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            교재명
                        </th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            코드 번호
                        </th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            문제 유형 제목
                        </th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                            난도
                        </th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                            페이지
                        </th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                            순서
                        </th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            비고
                        </th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                            관리
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for problem in problems %}
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-4 py-3 text-sm text-gray-900 font-medium">
                            {{ problem.book.title }}
                        </td>
                        <td class="px-4 py-3 text-sm font-mono text-gray-900">
                            {{ problem.problem_type.code_number }}
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-700">
                            {{ problem.problem_type.title }}
                        </td>
                        <td class="px-4 py-3 text-center">
                            <span class="px-2 py-1 rounded-full text-xs font-medium
                                {% if problem.problem_type.difficulty|add:0 >= 8 %}bg-red-100 text-red-800
                                {% elif problem.problem_type.difficulty|add:0 >= 5 %}bg-yellow-100 text-yellow-800
                                {% else %}bg-green-100 text-green-800{% endif %}">
                                {{ problem.problem_type.difficulty }}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-700 text-center">
                            {{ problem.page|default:"-" }}
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-700 text-center">
                            {{ problem.order }}
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-500">
                            {{ problem.memo|default:"-" }}
                        </td>
                        <td class="px-4 py-3 text-center">
                            <form action="{% url 'progress:book_problem_delete' problem.pk %}" method="POST" class="inline">
                                {% csrf_token %}
                                <button type="submit"
                                        onclick="return confirm('이 연결을 삭제하시겠습니까?');"
                                        class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-xs font-medium transition-colors">
                                    삭제
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="8" class="px-4 py-12 text-center text-gray-500">
                            {% if selected_book %}
                                선택한 교재에 연결된 문제가 없습니다.
                            {% else %}
                                연결된 문제가 없습니다. 먼저 문제 유형을 등록한 후 교재와 연결해주세요.
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
