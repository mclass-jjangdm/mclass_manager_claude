{% extends "bookstore/base_bookstore.html" %}
{% load humanize %}

{% block container_class %}wide-screen{% endblock %}

{% block bookstore_content %}
<div class="space-y-6">
    <!-- í—¤ë” ì˜ì—­ -->
    <div class="flex justify-between items-center">
        <div>
            <nav class="text-sm text-gray-500 mb-2">
                <a href="{% url 'bookstore:book_list' %}" class="hover:text-indigo-600">êµì¬ ëª©ë¡</a>
                <span class="mx-2">/</span>
                <a href="{% url 'bookstore:book_detail' book.pk %}" class="hover:text-indigo-600">{{ book.title }}</a>
                <span class="mx-2">/</span>
                <span class="text-gray-700">ì„¸ë¶€ ëª©ì°¨</span>
            </nav>
            <h2 class="text-2xl font-bold text-gray-800">{{ book.title }} - ì„¸ë¶€ ëª©ì°¨</h2>
            <p class="text-gray-600 mt-1">ISBN: {{ book.isbn }} | ì´ {{ total_pages }}í˜ì´ì§€ ë“±ë¡ë¨</p>
        </div>

        <div class="flex gap-3">
            <a href="{% url 'bookstore:book_content_upload' book.pk %}"
               class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                CSV ì—…ë¡œë“œ
            </a>
            {% if total_pages > 0 %}
            <form method="POST" action="{% url 'bookstore:book_content_delete_all' book.pk %}"
                  onsubmit="return confirm('ì •ë§ ëª¨ë“  ëª©ì°¨ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');" class="inline">
                {% csrf_token %}
                <button type="submit"
                        class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                    ì „ì²´ ì‚­ì œ
                </button>
            </form>
            {% endif %}
            <a href="{% url 'bookstore:book_detail' book.pk %}"
               class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                ëŒì•„ê°€ê¸°
            </a>
        </div>
    </div>

    {% if total_pages == 0 %}
    <!-- ëª©ì°¨ê°€ ì—†ì„ ë•Œ -->
    <div class="bg-white rounded-lg shadow p-12 text-center">
        <div class="text-gray-400 text-6xl mb-4">ğŸ“š</div>
        <h3 class="text-xl font-semibold text-gray-700 mb-2">ë“±ë¡ëœ ëª©ì°¨ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
        <p class="text-gray-500 mb-6">CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ êµì¬ì˜ ì„¸ë¶€ ëª©ì°¨ë¥¼ ë“±ë¡í•˜ì„¸ìš”.</p>
        <a href="{% url 'bookstore:book_content_upload' book.pk %}"
           class="inline-block bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
            ëª©ì°¨ ì—…ë¡œë“œí•˜ê¸°
        </a>
    </div>
    {% else %}
    <!-- ëª©ì°¨ í…Œì´ë¸” -->
    <div class="bg-white rounded-lg shadow overflow-hidden">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            ëŒ€ë‹¨ì›
                        </th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            ì¤‘ë‹¨ì›
                        </th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            ì†Œë‹¨ì›
                        </th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-20">
                            í˜ì´ì§€
                        </th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-20">
                            ê´€ë¦¬
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for content in contents %}
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-4 py-3 text-sm">
                            <span class="font-medium text-indigo-600">{{ content.chapter_num }}.</span>
                            {{ content.chapter_title }}
                        </td>
                        <td class="px-4 py-3 text-sm">
                            <span class="font-medium text-blue-600">{{ content.section_num }}.</span>
                            {{ content.section_title }}
                        </td>
                        <td class="px-4 py-3 text-sm">
                            {% if content.subsection_num %}
                            <span class="font-medium text-gray-500">{{ content.subsection_num }}.</span>
                            {% endif %}
                            {{ content.subsection_title }}
                        </td>
                        <td class="px-4 py-3 text-sm text-center font-semibold text-gray-700">
                            p.{{ content.page }}
                        </td>
                        <td class="px-4 py-3 text-center">
                            <div class="flex gap-1 justify-center">
                                <a href="{% url 'bookstore:book_content_edit' book.pk content.pk %}"
                                   class="text-indigo-600 hover:text-indigo-800 text-xs">
                                    ìˆ˜ì •
                                </a>
                                <form method="POST" action="{% url 'bookstore:book_content_delete' book.pk content.pk %}"
                                      onsubmit="return confirm('ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');" class="inline">
                                    {% csrf_token %}
                                    <button type="submit" class="text-red-600 hover:text-red-800 text-xs ml-2">
                                        ì‚­ì œ
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- ëŒ€ë‹¨ì›ë³„ ìš”ì•½ -->
    <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">ëª©ì°¨ êµ¬ì¡°</h3>
        <div class="space-y-4">
            {% for chapter_key, chapter_data in chapters.items %}
            <div class="border-l-4 border-indigo-500 pl-4">
                <h4 class="font-bold text-indigo-700">{{ chapter_key.0 }}. {{ chapter_key.1 }}</h4>
                <div class="ml-4 mt-2 space-y-2">
                    {% for section_key, subsections in chapter_data.sections.items %}
                    <div class="text-gray-700">
                        <span class="font-medium text-blue-600">{{ section_key.0 }}. {{ section_key.1 }}</span>
                        <span class="text-gray-500 text-sm ml-2">({{ subsections|length }}í˜ì´ì§€)</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
